<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>use-machine-ts</title><meta name="description" content="Documentation for use-machine-ts"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">use-machine-ts</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>use-machine-ts</h2></div><div class="tsd-panel tsd-typography"><a id="md:use-machine-ts" class="tsd-anchor"></a><h1><a href="#md:use-machine-ts">use-machine-ts</a></h1><p><strong>The tiny <em>state machine</em> hook for React</strong></p>
<p><a href="https://github.com/tai-kun/use-machine-ts/actions/workflows/ci.yaml"><img src="https://github.com/tai-kun/use-machine-ts/actions/workflows/ci.yaml/badge.svg" alt="CI"></a>
<a href="https://github.com/tai-kun/use-machine-ts/actions/workflows/release.yaml"><img src="https://github.com/tai-kun/use-machine-ts/actions/workflows/release.yaml/badge.svg" alt="Release on NPM"></a>
<a href="https://github.com/tai-kun/use-machine-ts/actions/workflows/canary-release.yaml"><img src="https://github.com/tai-kun/use-machine-ts/actions/workflows/canary-release.yaml/badge.svg" alt="Canary Release on NPM"></a></p>
<p><a href="https://bundlephobia.com/package/use-machine-ts"><img src="https://img.shields.io/bundlephobia/minzip/use-machine-ts/latest" alt="npm bundle size"></a>
<a href="https://www.npmjs.com/package/use-machine-ts"><img src="https://img.shields.io/npm/v/use-machine-ts" alt="npm version"></a>
<a href="https://www.npmjs.com/package/use-machine-ts?activeTab=versions"><img src="https://img.shields.io/npm/v/use-machine-ts/canary" alt="npm canary version"></a></p>
<p><a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-red.svg" alt="License: MIT"></a></p>
<p align="center">English (MT) | <a href="./README.ja.md">æ—¥æœ¬èªž</a></p>

<p>use-machine-ts is a tiny hook for designing state machines in React. Easily manage state transitions by following the idiomatic React patterns you&#39;re already familiar with.</p>
<details>
  <summary>File Size</summary>

<table>
<thead>
<tr>
<th align="left">source</th>
<th align="right">min+brotli</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>import { useMachine } from &quot;use-machine-ts&quot;</code></td>
<td align="right">973 B</td>
</tr>
<tr>
<td align="left"><code>import * from &quot;use-machine-ts&quot;</code></td>
<td align="right">1.37 KB</td>
</tr>
<tr>
<td align="left"><code>import * from &quot;use-machine-ts/standard&quot;</code></td>
<td align="right">1 KB</td>
</tr>
<tr>
<td align="left"><code>import * from &quot;use-machine-ts/shared&quot;</code></td>
<td align="right">1.04 KB</td>
</tr>
<tr>
<td align="left"><code>import * from &quot;use-machine-ts/synced&quot;</code></td>
<td align="right">1.08 KB</td>
</tr>
<tr>
<td align="left"></td>
<td align="right"></td>
</tr>
<tr>
<td align="left"><code>import { createMachine } from &quot;xstate@5.9.1&quot;</code> &amp; <code>import { useMachine } from &quot;@xstate/react@4.1.0&quot;</code></td>
<td align="right">11.12 KB</td>
</tr>
</tbody></table>
</details>

<a id="md:respect" class="tsd-anchor"></a><h2><a href="#md:respect">Respect</a></h2><p>use-machine-ts is inspired by <a href="https://github.com/cassiozen/useStateMachine">@cassiozen/usestatemachine</a>.</p>
<details>
  <summary>Difference between use-machine-ts and @cassiozen/usestatemachine</summary>

<ul>
<li>The state machine definition has been split into two parts instead of one. The separated items are debugging settings and the body of guard functions and effect functions. Since the implementation is not included in the state transition definition, you get the following benefits:<ul>
<li>You can concentrate more on thinking about state transitions.</li>
<li>Logs when state transitions are guarded are now clearer, making debugging easier. (See: <a href="#md:using-guards">Using Guards</a>)</li>
</ul>
</li>
<li>No need for special functions <code>t</code> for context and event type definitions.</li>
<li>State machines can be created in advance.</li>
<li>Asynchronous state machine state updates are now relatively safe. Specifically, behavior has been improved when the component is already unmounted. (See: <a href="#md:async-orchestration">Async Orchestration</a>)</li>
<li>In addition to <code>useMachine</code>, two other useful hooks are provided.<ul>
<li><code>useSharedMachine</code>: Allows you to share state between multiple React components. You can also manage state transitions from outside your React component.</li>
<li><code>useSyncedMachine</code>: Re-rendering is not triggered on every state transition. This hook provides a function that returns a snapshot of the state rather than the current state.</li>
</ul>
</li>
<li>ðŸ˜¢ The required React version has been increased from 16.8 to 18.</li>
<li>ðŸ˜¢ File size has increased. Comparing <code>useMachine</code>, it&#39;s an increase of about 400 bytes (+60%).</details></li>
</ul>
<a id="md:basic-features" class="tsd-anchor"></a><h2><a href="#md:basic-features">Basic Features</a></h2><ul>
<li>useMachine: Essentially a wrapper around <code>useState</code> and <code>useEffect</code>. Manages state transitions, similar to <code>useState</code>.</li>
<li>useSharedMachine: Essentially a wrapper around <code>usuSyncExternalState</code> and <code>useEffect</code>. You can share state between multiple React components. You can also manage state transitions from outside your React component.</li>
<li>useSyncedMachine: Similar to useMachine, but does not trigger a re-render on every state transition. This hook provides a function that returns a snapshot of the state rather than the current state.</li>
<li>createMachine: Create a state machine. This is useful for reusing State Machine Definitions in different components. Can be used with useMachine and useSyncedMachine.</li>
<li>createSharedMachine: Similar to createMachine, but only available with useSharedMachine.</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2><a href="#md:installation">Installation</a></h2><p>To install the latest stable version:</p>
<pre><code class="language-sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">use-machine-ts</span>
</code><button>Copy</button></pre>
<p>To install the canary version:</p>
<pre><code class="language-sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">use-machine-ts@canary</span>
</code><button>Copy</button></pre>
<a id="md:sample-usage" class="tsd-anchor"></a><h2><a href="#md:sample-usage">Sample Usage</a></h2><pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">guard:</span><span class="hl-1"> </span><span class="hl-2">&quot;isReady&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-4">effect:</span><span class="hl-1"> </span><span class="hl-2">&quot;onActive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">guards:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">isReady</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Now in the &#39;active&#39; state!&quot;</span><span class="hl-1">)</span><br/><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Now in the &#39;inactive&#39; state!&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">state</span><span class="hl-1">)</span><br/><span class="hl-7">// { value: &quot;inactive&quot;, context: undefined,</span><br/><span class="hl-7">//   event: { type: &quot;$init&quot; }, nextEvents: [&quot;TOGGLE&quot;] }</span><br/><br/><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;TOGGLE&quot;</span><span class="hl-1">)</span><br/><span class="hl-7">// Logs: Now in the &#39;active&#39; state!</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">state</span><span class="hl-1">)</span><br/><span class="hl-7">// { value: &quot;active&quot;, context: undefined,</span><br/><span class="hl-7">//   event: { type: &quot;TOGGLE&quot; }, nextEvents: [&quot;TOGGLE&quot;] }</span>
</code><button>Copy</button></pre>
<a id="md:todo" class="tsd-anchor"></a><h2><a href="#md:todo">TODO</a></h2><ul>
<li><input checked="" disabled="" type="checkbox"> Implement basic functionality.</li>
<li><input disabled="" type="checkbox"> Fix some incomplete tests.</li>
<li><input disabled="" type="checkbox"> Also test with <code>preact/compat</code>.</li>
<li><input disabled="" type="checkbox"> Check compatibility with React v19.</li>
</ul>
<a id="md:contents" class="tsd-anchor"></a><h2><a href="#md:contents">Contents</a></h2><ul>
<li><a href="#md:api">API</a><ul>
<li><a href="#md:usemachine">useMachine</a><ul>
<li><a href="#md:state">state</a></li>
<li><a href="#md:send">send</a></li>
<li><a href="#md:state-machine-definition">State Machine Definition</a></li>
<li><a href="#md:defining-states">Defining States</a></li>
<li><a href="#md:using-guards">Using Guards</a></li>
<li><a href="#md:using-effects">Using Effects</a></li>
<li><a href="#md:extended-state">Extended State</a></li>
<li><a href="#md:Schema">Schema</a></li>
<li><a href="#md:logging">Logging</a></li>
</ul>
</li>
<li><a href="#md:usesharedmachine">useSharedMachine</a></li>
<li><a href="#md:usesyncedmachine">useSyncedMachine</a></li>
</ul>
</li>
<li><a href="#md:async-orchestration">Async Orchestration</a><ul>
<li><a href="#md:usemachine-1">useMachine</a></li>
<li><a href="#md:usesharedmachine-1">useSharedMachine</a></li>
<li><a href="#md:usesyncedmachine-1">useSyncedMachine</a></li>
</ul>
</li>
</ul>
<a id="md:api" class="tsd-anchor"></a><h1><a href="#md:api">API</a></h1><a id="md:usemachine" class="tsd-anchor"></a><h2><a href="#md:usemachine">useMachine</a></h2><p>To create an improvised state machine:</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-7">/* State Machine Definition */</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">/* State Machine Configuration (Optional) */</span><span class="hl-1">,</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>To use a pre-built state machine:</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1">, </span><span class="hl-4">createMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">machine</span><span class="hl-1"> = </span><span class="hl-7">/* @__PURE__ */</span><span class="hl-1"> </span><span class="hl-0">createMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-7">/* State Machine Definition */</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">/* State Machine Configuration (Optional) */</span><span class="hl-1">,</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><span class="hl-4">machine</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>or:</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1">, </span><span class="hl-4">createMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">machine</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">createMachine</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">/* State Machine Definition */</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">/* State Machine Configuration (Optional) */</span><span class="hl-1">,</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><span class="hl-4">machine</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<a id="md:state" class="tsd-anchor"></a><h3><a href="#md:state">state</a></h3><p>The state machine&#39;s <code>state</code> consists of four properties: <code>value</code>, <code>event</code>, <code>nextEvents</code>, and <code>context</code>.</p>
<table>
<thead>
<tr>
<th align="left">Properties</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>value</code></td>
<td align="left"><code>string</code></td>
<td align="left">Current state. For example, <code>&quot;inactive&quot;</code> or <code>&quot;active&quot;</code>.</td>
</tr>
<tr>
<td align="left"><code>event</code></td>
<td align="left"><code>object</code></td>
<td align="left">The last sent event that caused the current state. For example, <code>{ type: &quot;TOGGLE&quot; }</code>. However, initially it is <code>{ type: &quot;$init&quot; }</code>.</td>
</tr>
<tr>
<td align="left"><code>nextEvents</code></td>
<td align="left"><code>string[]</code></td>
<td align="left">List of events that can be sent in the current state. For example, <code>[&quot;TOGGLE&quot;]</code>.</td>
</tr>
<tr>
<td align="left"><code>context</code></td>
<td align="left"><code>any</code></td>
<td align="left">The extended state of the state machine. See <a href="#md:extended-state">Extended State</a>.</td>
</tr>
</tbody></table>
<a id="md:send" class="tsd-anchor"></a><h3><a href="#md:send">send</a></h3><p>The <code>send</code> function is used to send events to the state machine. It takes one argument and passes a string (e.g. <code>&quot;TOGGLE&quot;</code>) or an object (e.g. <code>{ type: &quot;TOGGLE&quot; }</code>) representing the type of event.</p>
<p>If the current state accepts the event and the transition is possible (see <a href="#md:using-guards">Guards</a>), the state machine state is updated and the associated effects (see <a href="#md:using-effects">Effects</a>) are It will be executed.</p>
<p>You can send additional data using object-style events (e.g. <code>{ type: &quot;TOGGLE&quot;, value: 10 }</code>). See <a href="#md:schema">Schema</a> for how to define event types.</p>
<a id="md:state-machine-definition" class="tsd-anchor"></a><h3><a href="#md:state-machine-definition">State Machine Definition</a></h3><table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Required</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>initial</code></td>
<td align="left"><code>string</code></td>
<td align="left">âœ…</td>
<td align="left">Defines the initial state of the state machine.</td>
</tr>
<tr>
<td align="left"><code>states</code></td>
<td align="left"><code>object</code></td>
<td align="left">âœ…</td>
<td align="left">Defines the finite states that the state machine can take. (See: <a href="#md:defining-states">Defining States</a>)</td>
</tr>
<tr>
<td align="left"><code>on</code></td>
<td align="left"><code>object</code></td>
<td align="left"></td>
<td align="left">Defines the transition for events that cannot be accepted in the current state. (See: <a href="#md:defining-states">Defining States</a>)</td>
</tr>
<tr>
<td align="left"><code>context</code></td>
<td align="left"><code>any</code></td>
<td align="left"></td>
<td align="left">Defines the extended state of the state machine. (See: <a href="#md:extended-state">Extended State</a>)</td>
</tr>
<tr>
<td align="left"><code>$schema</code></td>
<td align="left"><code>object</code></td>
<td align="left"></td>
<td align="left">Defines the state machine schema as a type. (Reference: <a href="#md:schema">Schema</a>)</td>
</tr>
</tbody></table>
<a id="md:state-machine-configuration" class="tsd-anchor"></a><h3><a href="#md:state-machine-configuration">State Machine Configuration</a></h3><table>
<thead>
<tr>
<th align="left">Properties</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>guards</code></td>
<td align="left"><code>object</code></td>
<td align="left">Defines guard functions for the state machine. (See: <a href="#md:using-guards">Using Guards</a>)</td>
</tr>
<tr>
<td align="left"><code>effects</code></td>
<td align="left"><code>object</code></td>
<td align="left">Defines the state machine effect functions. (See: <a href="#md:using-effects">Using Effects</a>)</td>
</tr>
<tr>
<td align="left"><code>verbose</code></td>
<td align="left"><code>boolean</code> <code>0</code> <code>1</code> <code>2</code></td>
<td align="left">Enables debug logging. (Reference: <a href="#md:logging">Logging</a>)</td>
</tr>
<tr>
<td align="left"><code>console</code></td>
<td align="left"><code>object</code></td>
<td align="left">Defines a custom console for outputting logs. (Reference: <a href="#md:logging">Logging</a>)</td>
</tr>
</tbody></table>
<a id="md:defining-states" class="tsd-anchor"></a><h3><a href="#md:defining-states">Defining States</a></h3><p>A state machine can only be in one of a finite number of states. Also, state only changes due to events.</p>
<p>States are defined as keys in the <code>states</code> object, and event types are defined as keys in each state object&#39;s <code>on</code> object.</p>
<pre><code class="language-ts"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-8">states</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-7">// state name: state object</span><br/><span class="hl-1">    </span><span class="hl-8">inactive</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-8">on</span><span class="hl-1">: { </span><span class="hl-7">// event definition</span><br/><span class="hl-1">        </span><span class="hl-8">TOGGLE</span><span class="hl-1">: </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">, </span><span class="hl-7">// Event type: Destination state value</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-8">active</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-8">on</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-8">TOGGLE</span><span class="hl-1">: </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>In event definitions, you can use objects with a <code>target</code> property to have more control over state transitions (such as adding guards).</p>
<pre><code class="language-ts"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-8">on</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-8">TOGGLE</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-8">target</span><span class="hl-1">: </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-8">guard</span><span class="hl-1">: </span><span class="hl-2">&quot;isReady&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:using-guards" class="tsd-anchor"></a><h3><a href="#md:using-guards">Using Guards</a></h3><p>A guard is a function that is executed before the actual state transition. If the guard returns <code>true</code>, the state transition is allowed. If the guard returns <code>false</code>, the state transition is rejected.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">guard:</span><span class="hl-1"> </span><span class="hl-2">&quot;isReady&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">guards:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">isReady</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>use-machine-ts provides three helper functions: <code>and</code>, <code>or</code>, and <code>not</code>. You can use these functions to create complex guards.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">and</span><span class="hl-1">, </span><span class="hl-4">not</span><span class="hl-1">, </span><span class="hl-4">or</span><span class="hl-1">, </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">guard:</span><span class="hl-1"> </span><span class="hl-0">and</span><span class="hl-1">(</span><span class="hl-0">or</span><span class="hl-1">(</span><span class="hl-2">&quot;isReady&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;isStopped&quot;</span><span class="hl-1">), </span><span class="hl-0">not</span><span class="hl-1">(</span><span class="hl-2">&quot;isDestroyed&quot;</span><span class="hl-1">)),</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">guards:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">isReady</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">isStopped</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">isDestroyed</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>The <code>and</code> function can simply be replaced with an array.</p>
<pre><code class="language-ts"><span class="hl-0">and</span><span class="hl-1">(</span><span class="hl-0">or</span><span class="hl-1">(</span><span class="hl-2">&quot;isReady&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;isStopped&quot;</span><span class="hl-1">), </span><span class="hl-0">not</span><span class="hl-1">(</span><span class="hl-2">&quot;isDestroyed&quot;</span><span class="hl-1">))</span><br/><span class="hl-7">// equals</span><br/><span class="hl-1">[</span><span class="hl-0">or</span><span class="hl-1">(</span><span class="hl-2">&quot;isReady&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;isStopped&quot;</span><span class="hl-1">), </span><span class="hl-0">not</span><span class="hl-1">(</span><span class="hl-2">&quot;isDestroyed&quot;</span><span class="hl-1">)]</span>
</code><button>Copy</button></pre>
<p>If <code>guard</code> eventually returns <code>false</code>, you will see a log similar to the following:</p>
<pre><code class="language-console"><span class="hl-1">Transition from &#39;inactive&#39; to &#39;active&#39; denied by guard.</span><br/><span class="hl-1">((isReady || isStopped) &amp;&amp; !isDestroyed)</span><br/><span class="hl-1">                           ^^^^^^^^^^^^ </span><br/><span class="hl-1">Event { type: &quot;TOGGLE&quot; }</span><br/><span class="hl-1">Context undefined</span>
</code><button>Copy</button></pre>
<p><code>^</code> indicates the reason why the guard rejected the state transition. In the example above, we can see that the state transition was rejected because <code>isDestroyed</code> returned <code>true</code>.</p>
<blockquote>
<p>[!IMPORTANT]
<code>and</code> with no guards always returns <code>true</code>. Similarly, <code>or</code> with no guards always returns <code>false</code>.</p>
</blockquote>
<a id="md:using-effects" class="tsd-anchor"></a><h3><a href="#md:using-effects">Using Effects</a></h3><p>An effect is a function that is executed when the state machine enters a particular state. If you return a function from an effect, that function will be executed when you leave the state. This works similar to the <code>useEffect</code> hook in React.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-4">effect:</span><span class="hl-1"> </span><span class="hl-2">&quot;onActive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">entryParams</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Entered &#39;active&#39; state!&quot;</span><span class="hl-1">)</span><br/><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">exitParams</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Left from &#39;active&#39; state!&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>You can also pass an array to the <code>effect</code> property instead of a string.</p>
<pre><code class="language-ts"><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-8">effect</span><span class="hl-1">: [</span><br/><span class="hl-1">     </span><span class="hl-2">&quot;onActive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">     </span><span class="hl-2">&quot;onTransition&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   ],</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The effect function takes as a parameter an object (<code>entryParams</code>) with four properties:</p>
<table>
<thead>
<tr>
<th align="left">Properties</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>event</code></td>
<td align="left"><code>object</code></td>
<td align="left">The event that caused the transition to the current state. Events always use object format (e.g. <code>{ type: &quot;TOGGLE&quot; }</code>).</td>
</tr>
<tr>
<td align="left"><code>context</code></td>
<td align="left"><code>any</code></td>
<td align="left">The extended state of the state machine.</td>
</tr>
<tr>
<td align="left"><code>send</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function for sending events to the state machine.</td>
</tr>
<tr>
<td align="left"><code>setContext</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function for updating the extended state of the state machine. Since it returns an object with a <code>send</code> property, you can write <code>context</code> updates and state transitions in one line.</td>
</tr>
<tr>
<td align="left"><code>isMounted</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function to check whether the component is mounted.</td>
</tr>
</tbody></table>
<p>The function returned by the effect function takes as a parameter an object (<code>exitParams</code>) with four properties:</p>
<table>
<thead>
<tr>
<th align="left">Properties</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>event</code></td>
<td align="left"><code>object</code></td>
<td align="left">The event that caused the transition from the current state. Events always use object format (e.g. <code>{ type: &quot;TOGGLE&quot; }</code>).</td>
</tr>
<tr>
<td align="left"><code>context</code></td>
<td align="left"><code>any</code></td>
<td align="left">The extended state of the state machine.</td>
</tr>
<tr>
<td align="left"><code>send</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function for sending events to the state machine.</td>
</tr>
<tr>
<td align="left"><code>setContext</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function for updating the extended state of the state machine. Since it returns an object with a <code>send</code> property, you can write <code>context</code> updates and state transitions in one line.</td>
</tr>
<tr>
<td align="left"><code>isMounted</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function to check whether the component is mounted.</td>
</tr>
</tbody></table>
<p>The following example updates <code>retryCount</code> each time it enters a failure state, and transitions to an error state when the limit is reached.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;loading&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">context:</span><span class="hl-1"> { </span><span class="hl-4">retryCount:</span><span class="hl-1"> </span><span class="hl-9">0</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">loading:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">FAILURE:</span><span class="hl-1"> </span><span class="hl-2">&quot;failure&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">DONE:</span><span class="hl-1"> </span><span class="hl-2">&quot;done&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">failure:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">RETRY:</span><span class="hl-1"> </span><span class="hl-2">&quot;loading&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">ERROR:</span><span class="hl-1"> </span><span class="hl-2">&quot;error&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-4">effect:</span><span class="hl-1"> </span><span class="hl-2">&quot;onFailure&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">RETRY:</span><span class="hl-1"> </span><span class="hl-2">&quot;loading&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-4">effect:</span><span class="hl-1"> [</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;onError&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;resetRetryCount&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        ],</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">done:</span><span class="hl-1"> {},</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">onFailure</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1">, </span><span class="hl-4">send</span><span class="hl-1">, </span><span class="hl-4">setContext</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">retryCount</span><span class="hl-1"> &lt; </span><span class="hl-9">3</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">setContext</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-4">retryCount:</span><span class="hl-1"> </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">retryCount</span><span class="hl-1"> + </span><span class="hl-9">1</span><span class="hl-1"> })).</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;RETRY&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">        } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;ERROR&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> ({ </span><span class="hl-4">event</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-2">&quot;RETRY&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Retrying...&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">          } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;The number of retries has reached the upper limit!&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">onError</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Error state entered!&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">resetRetryCount</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">setContext</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">setContext</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-4">retryCount:</span><span class="hl-1"> </span><span class="hl-9">0</span><span class="hl-1"> }))</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<blockquote>
<p>[!WARNING]
State machine definitions and configurations are immutable. It cannot be changed midway. Functions defined with <code>effects</code>, <code>guards</code>, etc. continue to refer to the values they had when they were first defined. Therefore, care should be taken when directly monitoring state changes, for example.</p>
</blockquote>
<p>The following example shows how to use React&#39;s <code>useEffect</code> hook to update the state of a component when the state of the state machine changes. This works correctly.</p>
<pre><code class="language-ts"><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">Component</span><span class="hl-1">(</span><span class="hl-4">props</span><span class="hl-1">: { </span><span class="hl-0">onActive</span><span class="hl-1">: () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1"> }) {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">onActive</span><span class="hl-1"> } = </span><span class="hl-4">props</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">/* State Machine Definition */</span><span class="hl-1">,</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  )</span><br/><br/><span class="hl-1">  </span><span class="hl-0">useEffect</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">value</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">onActive</span><span class="hl-1">()</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }, [</span><span class="hl-4">state</span><span class="hl-1">])</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>You might find the above example redundant and end up writing code like this: However, this can lead to serious bugs.</p>
<pre><code class="language-ts"><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">Component</span><span class="hl-1">(</span><span class="hl-4">props</span><span class="hl-1">: { </span><span class="hl-0">onToggle</span><span class="hl-1">: (</span><span class="hl-4">isActive</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1"> }) {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">onToggle</span><span class="hl-1"> } = </span><span class="hl-4">props</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">/* State Machine Definition */</span><span class="hl-1">,</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-7">// If props.onToggle is changed, the change will not be reflected.</span><br/><span class="hl-1">          </span><span class="hl-7">// Always refers to the first defined value, which can lead to serious bugs.</span><br/><span class="hl-1">          </span><span class="hl-0">onToggle</span><span class="hl-1">()</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>You can also work around this problem by using <code>useRef</code> to always refer to the latest function, like this:</p>
<pre><code class="language-ts"><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">Component</span><span class="hl-1">(</span><span class="hl-4">props</span><span class="hl-1">: { </span><span class="hl-0">onToggle</span><span class="hl-1">: (</span><span class="hl-4">isActive</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1"> }) {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">onToggle</span><span class="hl-1"> = </span><span class="hl-4">React</span><span class="hl-1">.</span><span class="hl-0">useRef</span><span class="hl-1">(</span><span class="hl-4">props</span><span class="hl-1">.</span><span class="hl-4">onToggle</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-4">onToggle</span><span class="hl-1">.</span><span class="hl-4">current</span><span class="hl-1"> = </span><span class="hl-4">props</span><span class="hl-1">.</span><span class="hl-4">onToggle</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">/* State Machine Definition */</span><span class="hl-1">,</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">onToggle</span><span class="hl-1">.</span><span class="hl-0">current</span><span class="hl-1">(</span><span class="hl-5">true</span><span class="hl-1">)</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>However, there is still the possibility of human error. In practice, we recommend using predefined machines to transfer values that depend on React components.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">createMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">machine</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-0">props</span><span class="hl-1">: () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">initial</span><span class="hl-1">: </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;active&quot;</span><br/><span class="hl-1">    </span><span class="hl-4">onToggle</span><span class="hl-1">: ((</span><span class="hl-4">isActive</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">) | </span><span class="hl-10">undefined</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">createMachine</span><span class="hl-1">(</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-0">props</span><span class="hl-1">().</span><span class="hl-4">initial</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">          </span><span class="hl-4">effect:</span><span class="hl-1"> </span><span class="hl-2">&quot;onInactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">          </span><span class="hl-4">effect:</span><span class="hl-1"> </span><span class="hl-2">&quot;onActive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">onToggle</span><span class="hl-1"> } = </span><span class="hl-0">props</span><span class="hl-1">()</span><br/><span class="hl-1">          </span><span class="hl-0">onToggle</span><span class="hl-1">?.(</span><span class="hl-5">true</span><span class="hl-1">)</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-0">onInactive</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">onToggle</span><span class="hl-1"> } = </span><span class="hl-0">props</span><span class="hl-1">()</span><br/><span class="hl-1">          </span><span class="hl-0">onToggle</span><span class="hl-1">?.(</span><span class="hl-5">false</span><span class="hl-1">)</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">ToggleButton</span><span class="hl-1">(</span><span class="hl-4">props</span><span class="hl-1">: { </span><span class="hl-0">onToggle</span><span class="hl-1">?: (</span><span class="hl-4">isActive</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1"> }) {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><span class="hl-4">machine</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">onToggle:</span><span class="hl-1"> </span><span class="hl-4">props</span><span class="hl-1">.</span><span class="hl-4">onToggle</span><span class="hl-1">,</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The machine predefined in the form of functions can accept one argument. This argument must be a function. This function is a wrapper around <code>useRef</code> and always returns the latest value.</p>
<a id="md:extended-state" class="tsd-anchor"></a><h3><a href="#md:extended-state">Extended State</a></h3><p>In addition to a finite number of states, a state machine can have extended states (called contexts). Define the initial extension state using the <code>context</code> property and update the extension state using the <code>setContext</code> function.</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">context:</span><span class="hl-1"> { </span><span class="hl-4">toggleCount:</span><span class="hl-1"> </span><span class="hl-9">0</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-4">effect:</span><span class="hl-1"> </span><span class="hl-2">&quot;onActive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">setContext</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">setContext</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-4">toggleCount:</span><span class="hl-1"> </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">toggleCount</span><span class="hl-1"> + </span><span class="hl-9">1</span><span class="hl-1"> }))</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">) </span><span class="hl-7">// { toggleCount: 0 }</span><br/><br/><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;TOGGLE&quot;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">) </span><span class="hl-7">// { toggleCount: 1 }</span>
</code><button>Copy</button></pre>
<a id="md:schema" class="tsd-anchor"></a><h3><a href="#md:schema">Schema</a></h3><p>TypeScript automatically infers context and event types, but you can also explicitly define a state machine&#39;s schema using the <code>$schema</code> property. This object is never used at runtime.</p>
<p>The <code>$schema</code> property has three properties: <code>context</code>, <code>events</code>, and <code>strict</code>.</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Required</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>context</code></td>
<td align="left"><code>any</code></td>
<td align="left"></td>
<td align="left">Defines the type of extended state of the state machine.</td>
</tr>
<tr>
<td align="left"><code>events</code></td>
<td align="left"><code>object</code></td>
<td align="left"></td>
<td align="left">Defines the type of state machine events.</td>
</tr>
<tr>
<td align="left"><code>strict</code></td>
<td align="left"><code>boolean</code></td>
<td align="left"></td>
<td align="left">Enable strict mode for the schema. When set to <code>true</code>, automatic inference is disabled and contexts and events not defined in the schema result in type errors.</td>
</tr>
</tbody></table>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">$schema:</span><span class="hl-1"> {} </span><span class="hl-3">as</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">context</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-4">toggleCount</span><span class="hl-1">: </span><span class="hl-10">number</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">events</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-4">TOGGLE</span><span class="hl-1">: {</span><br/><span class="hl-1">          </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-10">Date</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">context:</span><span class="hl-1"> { </span><span class="hl-4">toggleCount:</span><span class="hl-1"> </span><span class="hl-9">0</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-4">effect:</span><span class="hl-1"> </span><span class="hl-2">&quot;onActive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">setContext</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-0">setContext</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-4">toggleCount:</span><span class="hl-1"> </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">toggleCount</span><span class="hl-1"> + </span><span class="hl-9">1</span><span class="hl-1"> }))</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;TOGGLE&quot;</span><span class="hl-1">) </span><span class="hl-7">// Type Error !</span><br/><br/><span class="hl-0">send</span><span class="hl-1">({ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;TOGGLE&quot;</span><span class="hl-1">, </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">() }) </span><span class="hl-7">// OK (^_^)b</span><br/><br/><span class="hl-7">// Logs: { type: &quot;TOGGLE&quot;, timestamp: 2024-01-01T00:00:00.000Z }</span>
</code><button>Copy</button></pre>
<a id="md:logging" class="tsd-anchor"></a><h3><a href="#md:logging">Logging</a></h3><p>You can enable state machine logging if needed. Use the <code>verbose</code> property to set the verbosity of the log. .</p>
<table>
<thead>
<tr>
<th align="left">Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>0</code> or <code>false</code></td>
<td align="left">Disable logging.</td>
</tr>
<tr>
<td align="left"><code>1</code></td>
<td align="left">Outputs only errors to the log. (default)</td>
</tr>
<tr>
<td align="left"><code>2</code> or <code>true</code></td>
<td align="left">Output errors and debugging information to the log.</td>
</tr>
</tbody></table>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">verbose:</span><span class="hl-1"> </span><span class="hl-9">2</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<blockquote>
<p>[!NOTE]
Logging is disabled when <code>process.env.NODE_ENV</code> is <code>&quot;production&quot;</code>.</p>
</blockquote>
<a id="md:usesharedmachine" class="tsd-anchor"></a><h2><a href="#md:usesharedmachine">useSharedMachine</a></h2><p>To use <code>useSharedMachine</code>, you need to use a state machine created with <code>createSharedMachine</code>.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useSharedMachine</span><span class="hl-1">, </span><span class="hl-4">createSharedMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sharedMachine</span><span class="hl-1"> = </span><span class="hl-0">createSharedMachine</span><span class="hl-1">(</span><br/><span class="hl-1">   </span><span class="hl-7">/* State Machine Definition */</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-7">/* State Machine Configuration (Optional) */</span><span class="hl-1">,</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useSharedMachine</span><span class="hl-1">(</span><span class="hl-4">sharedMachine</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p><code>useSharedMachine</code> works similarly to <code>useMachine</code>, but allows you to manage state transitions externally. It&#39;s essentially a wrapper around <code>useSyncExternalState</code> and <code>useEffect</code>. If I may borrow your knowledge, I can give an analogy with the relationship between <code>atom</code> and <code>useAtom</code>.</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">machineAtom</span><span class="hl-1"> = </span><span class="hl-0">atom</span><span class="hl-1">() </span><span class="hl-7">/* Initial State */</span><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">setState</span><span class="hl-1">] = </span><span class="hl-0">useAtom</span><span class="hl-1">(</span><span class="hl-4">machineAtom</span><span class="hl-1">)</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">send</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">nextState</span><span class="hl-1"> = </span><span class="hl-0">eventToNextState</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">state</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-0">setState</span><span class="hl-1">(</span><span class="hl-4">nextState</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>A shared state machine is an object with six properties: <code>instance</code>, <code>dispatch</code>, <code>send</code>, <code>setContext</code>, <code>getState</code>, and <code>subscribe</code>.</p>
<table>
<thead>
<tr>
<th align="left">Properties</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>instance</code></td>
<td align="left"><code>[Definition, Configuration?]</code></td>
<td align="left">An instance of the state machine.</td>
</tr>
<tr>
<td align="left"><code>dispatch</code></td>
<td align="left"><code>function</code></td>
<td align="left">A function to send events to the state machine. Primitive functions used by <code>send</code> and <code>setContext</code>.</td>
</tr>
<tr>
<td align="left"><code>send</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function for sending events to the state machine.</td>
</tr>
<tr>
<td align="left"><code>setContext</code></td>
<td align="left"><code>function</code></td>
<td align="left">Function for updating the extended state of the state machine.</td>
</tr>
<tr>
<td align="left"><code>getState</code></td>
<td align="left"><code>function</code></td>
<td align="left">A function to get the current state of the state machine.</td>
</tr>
<tr>
<td align="left"><code>subscribe</code></td>
<td align="left"><code>function</code></td>
<td align="left">A function to monitor state changes in the state machine.</td>
</tr>
</tbody></table>
<a id="md:usesyncedmachine" class="tsd-anchor"></a><h2><a href="#md:usesyncedmachine">useSyncedMachine</a></h2><p>Similar to <code>useMachine</code>, but does not trigger a re-render on every state transition. This hook provides a function that returns a snapshot of the state rather than the current state.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useSyncedMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">getState</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useSyncedMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-0">getState</span><span class="hl-1">())</span><br/><span class="hl-7">// { value: &quot;inactive&quot;, context: undefined,</span><br/><span class="hl-7">// event: { type: &quot;$init&quot; }, nextEvents: [&quot;TOGGLE&quot;] }</span><br/><br/><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;TOGGLE&quot;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-0">getState</span><span class="hl-1">())</span><br/><span class="hl-7">// { value: &quot;active&quot;, context: undefined,</span><br/><span class="hl-7">// event: { type: &quot;TOGGLE&quot; }, nextEvents: [&quot;TOGGLE&quot;] }</span>
</code><button>Copy</button></pre>
<a id="md:async-orchestration" class="tsd-anchor"></a><h1><a href="#md:async-orchestration">Async Orchestration</a></h1><blockquote>
<p>[!WARNING]
In use-machine-ts, you should avoid updating the state machine state asynchronously.</p>
</blockquote>
<p>There are a few things to keep in mind when updating state machine state asynchronously. Each of the three hooks (<code>useMachine</code>, <code>useSharedMachine</code>, <code>useSyncedMachine</code>) provided by use-machine-ts has different points to note.</p>
<a id="md:usemachine-1" class="tsd-anchor"></a><h2><a href="#md:usemachine-1">useMachine</a></h2><p>Inside <code>useMachine</code>, you can call the <code>send</code> and <code>setContext</code> functions asynchronously as long as the component is mounted. However, if the component is already unmounted, these functions instead of changing the state will display an error message like this:</p>
<pre><code class="language-console"><span class="hl-1">Cannot dispatch an action to the state machine after the component is unmounted.</span><br/><span class="hl-1">Action { type: &quot;SEND&quot;, payload: { type: &quot;TOGGLE&quot; } }</span>
</code><button>Copy</button></pre>
<p>For <code>setContext</code>, the value of the <code>type</code> property is <code>&quot;SET_CONTEXT&quot;</code>.</p>
<p>To check if a component is unmounted beforehand, you can use the <code>isMounted</code> property of the parameter passed to the <code>effect</code> function. The <code>isMounted</code> function returns <code>true</code> if the component is mounted, <code>false</code> otherwise.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">useMachine</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;use-machine-ts&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">send</span><span class="hl-1">] = </span><span class="hl-0">useMachine</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">inactive:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">active:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">on:</span><span class="hl-1"> { </span><span class="hl-4">TOGGLE:</span><span class="hl-1"> </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">effects:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">send</span><span class="hl-1">, </span><span class="hl-4">isMounted</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">setTimeout</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-0">isMounted</span><span class="hl-1">()) {</span><br/><span class="hl-1">            </span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;TOGGLE&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }, </span><span class="hl-9">1000</span><span class="hl-1">)</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<a id="md:usesharedmachine-1" class="tsd-anchor"></a><h2><a href="#md:usesharedmachine-1">useSharedMachine</a></h2><p>Inside <code>useSharedMachine</code>, you can call <code>send</code>, <code>setContext</code>, or <code>dispatch</code> on the shared machine asynchronously, regardless of the mounted state of the component. Note that no error or warning messages are displayed. To check if a component is unmounted beforehand, you can use the <code>isMounted</code> function, similar to <code>useMachine</code>.</p>
<a id="md:usesyncedmachine-1" class="tsd-anchor"></a><h2><a href="#md:usesyncedmachine-1">useSyncedMachine</a></h2><p>The <code>send</code> and <code>setContext</code> functions cannot be called asynchronously within <code>useSyncedMachine</code>, regardless of the mounted state of the component. These functions are unlocked just before the effect starts and locked after it ends. If you call these functions while locked, you will receive an error message similar to the following:</p>
<pre><code class="language-console"><span class="hl-1">Send function not available. Must be used synchronously within an effect.</span><br/><span class="hl-1">State { value: &quot;inactive&quot;, event: { type: &quot;$init&quot; }, nextEvents: [&quot;TOGGLE&quot;], context: undefined }</span><br/><span class="hl-1">Event: { type: &quot;TOGGLE&quot; }</span>
</code><button>Copy</button></pre>
<p>However, the <code>send</code> function returned by <code>useSyncedMachine</code> warns you with an error message that the component is unmounted.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:use-machine-ts"><span>use-<wbr/>machine-<wbr/>ts</span></a><ul><li><a href="#md:respect"><span>Respect</span></a></li><li><a href="#md:basic-features"><span>Basic <wbr/>Features</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:sample-usage"><span>Sample <wbr/>Usage</span></a></li><li><a href="#md:todo"><span>TODO</span></a></li><li><a href="#md:contents"><span>Contents</span></a></li></ul><a href="#md:api"><span>API</span></a><ul><li><a href="#md:usemachine"><span>use<wbr/>Machine</span></a></li><li><ul><li><a href="#md:state"><span>state</span></a></li><li><a href="#md:send"><span>send</span></a></li><li><a href="#md:state-machine-definition"><span>State <wbr/>Machine <wbr/>Definition</span></a></li><li><a href="#md:state-machine-configuration"><span>State <wbr/>Machine <wbr/>Configuration</span></a></li><li><a href="#md:defining-states"><span>Defining <wbr/>States</span></a></li><li><a href="#md:using-guards"><span>Using <wbr/>Guards</span></a></li><li><a href="#md:using-effects"><span>Using <wbr/>Effects</span></a></li><li><a href="#md:extended-state"><span>Extended <wbr/>State</span></a></li><li><a href="#md:schema"><span>Schema</span></a></li><li><a href="#md:logging"><span>Logging</span></a></li></ul></li><li><a href="#md:usesharedmachine"><span>use<wbr/>Shared<wbr/>Machine</span></a></li><li><a href="#md:usesyncedmachine"><span>use<wbr/>Synced<wbr/>Machine</span></a></li></ul><a href="#md:async-orchestration"><span>Async <wbr/>Orchestration</span></a><ul><li><a href="#md:usemachine-1"><span>use<wbr/>Machine</span></a></li><li><a href="#md:usesharedmachine-1"><span>use<wbr/>Shared<wbr/>Machine</span></a></li><li><a href="#md:usesyncedmachine-1"><span>use<wbr/>Synced<wbr/>Machine</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>use-machine-ts</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>